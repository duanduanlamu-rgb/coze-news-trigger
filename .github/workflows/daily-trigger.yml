name: Daily Coze News Trigger

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 8:00 è§¦å‘
    # å›½å†…ç‰ˆç”¨åŒ—äº¬æ—¶é—´ï¼Œä¸éœ€è¦è½¬æ¢UTC
    - cron: '0 8 * * *'
  
  # å…è®¸æ‰‹åŠ¨è¿è¡Œï¼ˆç”¨äºæµ‹è¯•ï¼‰
  workflow_dispatch:

jobs:
  trigger-coze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Get Current Date
      id: date
      run: |
        echo "today=$(date +'%mæœˆ%dæ—¥')" >> $GITHUB_OUTPUT
    
    - name: Trigger Coze Workflow
      run: |
        curl -X POST 'https://api.coze.cn/v1/workflow/stream_run' \
          -H 'Authorization: Bearer ${{ secrets.COZE_TOKEN }}' \
          -H 'Content-Type: application/json' \
          -d '{
            "workflow_id": "7572968865026588722",
            "parameters": {},
            "mail_ac": "${{ secrets.MAIL_AC }}",
            "email_pwd": "${{ secrets.EMAIL_PWD }}",
            "time": "'"${{ steps.date.outputs.today }}"'",
            "to_mail_ac": "${{ secrets.TO_MAIL_AC }}"
          }'
    
    - name: Show Success
      run: |
        echo "âœ… æ‰£å­æ–°é—»å·¥ä½œæµè§¦å‘æˆåŠŸï¼"
        echo "ğŸ“… æ—¥æœŸ: ${{ steps.date.outputs.today }}"
